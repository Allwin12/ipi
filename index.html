<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
  </head>
  <body>
    <canvas id="game-canvas"></canvas>
    <script type="module">
      import init, { Universe } from "./pkg/ipi_game.js";
      import * as util from "./util.js";

      let universe;
      let system_running = true;

      function draw() {
        window.requestAnimationFrame(draw);
        if (!system_running) {
          return;
        }
        universe.tick();
        const canvas = document.getElementById("game-canvas");
        canvas.width = universe.width();
        canvas.height = universe.height();
        const ctx = canvas.getContext("2d");
        for (var i = 0; i < universe.num_stars(); i++) {
          ctx.beginPath();
          ctx.arc(
            universe.star_x(i),
            universe.star_y(i),
            universe.star_radius(i),
            0,
            Math.PI * 2,
            true
          );
          ctx.fill();
        }
        for (var i = 0; i < universe.num_planets(); i++) {
          ctx.beginPath();
          ctx.arc(
            universe.planet_x(i),
            universe.planet_y(i),
            universe.planet_radius(i),
            0,
            Math.PI * 2,
            true
          );
          ctx.fill();
        }
      }

      async function run() {
        await init();
        const canvas = document.getElementById("game-canvas");
        canvas.addEventListener("click", function () {
          system_running = !system_running;
        });
        universe = Universe.new(window.innerWidth, window.innerHeight, 3);
        window.requestAnimationFrame(draw);
      }

      run();
    </script>
  </body>
</html>
